\section{Evaluation}
\label{sec:evaluation}

In this section we evaluate Jorvik in three different ways. 
In the first evaluation, we apply Jorvik to generate a Papyrus editor for the non-trivial Archimate UML profile~\cite{iacob2009archimate,haren2012archimate}. 
We use the Adocus Archimate for Papyrus\footnote{\url{https://github.com/Adocus/ArchiMate-for-Papyrus}} (an open-source tool that includes a profile for Archimate and the appropriate editors for Papyrus) for reference. 
We compare the proportion of the tool that Jorvik is able to generate automatically, check the number of polishing transformations that the user needs to write to complete the missing parts and finally, identify the aspects of the editor that our approach is not able to generate.
As a result we can to measure the \textit{efficiency} of Jorvik in generating profiles/editors against an existing relatively large profile/editor. 

In the second evaluation, we assess the completeness of Jorvik by applying it to a number of metamodels collected as part of the work presented in~\cite{williams2013metamodels}. 
This way, Jorvik is tested to check if it can successfully generate profiles and editors for a wide variety of scenarios.

In the third evaluation, we conduct a user experiment in which we asked software engineers to build Papyrus editors for a two metamodels. 
We first ask the engineers to create the profiles and editors manually, and then ask them to create the same profiles and editors using Jorvick. 
We measure the time and report problems encountered during the experiment and we compare the results.

\subsection{Efficiency}
\label{sec:efficiencyEvaluation}
The Archimate for Papyrus tool offers five kinds of diagrams (i.e., Application, Business, Implementation and Migration, Motivation and Technology diagrams). 
Each of the diagrams uses different stereotypes from the Archimate profile. 
In this scenario, we create five Ecore metamodels and annotate the elements that need to appear as nodes/edges in the diagrams. 
We then generate the editors for each kind of the Archimate diagram.
At this point, five fully functional editors are generated that can be used to create each of the five types of diagrams that the Archimate for Papyrus tool also supports. 

However, our generated editors do not offer some special features that the Archimate for Papyrus tool offers. 
For example, Archimate for Papyrus offers a third drawer in the palette for some diagrams that is called ``Common'' and includes two tools (named ``Grouping'' and ``Comment''). 
Another feature that is not supported by our default transformations is the fact that in Archimate for Papyrus, users are able to have the elements represented either by their shapes or by a coloured rectangle depending on the CSS class applied to them. 
We also find out that Archimate for Papyrus also organises the creation of the \textit{Junction} (which is a node that acts as a junction for edges) node in the relations drawer in the palette. 
In order to be able to implement such missing features, we need to write the extra polishing transformations. 
We do not go into details on the content of the polishing transformations for this specific example\footnote{The generated Plug-ins for Archimate and the polishing transformations are available from \url{https://github.com/wrwei/Jorvik}}.

In our previous work \cite{zolotas2018towards}, we compared our approach with Archimate for Papyrus. 
However, as we mentioned in Section~\ref{sec:background}, Papyrus changed its underlying metamodels and the mechanism for creating UML specific editors. 
Thus, we generated all the Archimate editors using Jorvik, which are compatible to Papyrus 3.0+ (Archimate for Papyrus does not support Papyrus 3.0+). 

Table~\ref{tab:evaluation} summarises the efficiency of Jorvik in terms of lines of code written, both for Jorvik pre-Papyrus 3.0 version and for Jorvik post-Papyrus 3.0 version\footnote{Cells in gray are artefacts not needed for implementation. E.g. Creation Command and Architecture Model are concepts in Papyrus version 3.0+, and therefore are not applicable to Jorvik pre-Papyrus 3.0 version and Arhicmate for Papyrus}.
The numbers are shown in the format of \textit{Lines of Code (Number of Object)}, for we count both the lines of code and (equivalent) number of objects needed to be manually created.

For Jorvick pre-Papyrus 3.0 (columns under \textit{Jorvick (pre-Papyrus 3.0)}), we need to manually create five annotated Ecore metamodels, which involves writing 436 lines of code (668 objects). 
For polish transformations, we need to write 11 lines for Element Types Configuration, 50 lines for Palette Configuration, 195 lines for CSS and 10 lines for Types Configuration.

For Jorvick post-Papyrus 3.0 (columns under \textit{Jorvick (post-Papyrus 3.0)}), we need the same Ecore metamodels, thus the numbers do not change. 
For polish transformations, we need to write 50 lines for the Palette Configuration and 195 lines for CSS. 

As it can be observed from the numbers, our approach requires about 90\% less handwritten code to produce the basic diagrams and about 85\% less code to 
produce the polished editor that matches the original Archimate for Papyrus editor. 
Jorvik offers editors that match the original Archimate for Papyrus tool.
In addition, Jorvik automatically produces an ETL model-to-model transformation, which supports the transformation from Archimate models in UML to their counter parts in EMF.
Jorvik also generates a set of OCL constraints for all edges in Archimate, which is also an extra feature that Jorvik offers.
In this scenario, however, the generation of constraints could not be assessed as the tool that we are comparing with (i.e., Archimate for Papyrus) allows any edge to connect any two types of nodes. We leave this evaluation as part of our future work.

\captionsetup{justification=centering}
\begin{landscape}
	\topskip0pt
%	\vspace*{\fill}
\begin{table}[htb!]
	\centering
	\setlength{\tabcolsep}{3.5pt} 
	\begin{tabular}{M{1.5cm}|M{2cm}|M{2cm}|c|M{2cm}|M{2cm}|c|M{2cm}|}
		\cline{2-8}
		& \multicolumn{3}{c|}{\textbf{Jorvik (pre-Papyrus 3.0)} LoC (Obj)} & \multicolumn{3}{c|}{\textbf{Jorvik (post-Papyrus 3.0)}  LoC (Obj)} & \textbf{Archimate for Papyrus (Pre Papyrus 3.0)}\\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{File}} & \textbf{Hand-written} & \textbf{Hand-written (Polishing)} & \textbf{Total} & \textbf{Hand-written} & \textbf{Hand-written (Polishing)} & \textbf{Total} & \textbf{Total Hand-written}\\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{ECore}} & 436 (668) & 0 & 436 (668) & 436 (668) & 0 & 436 (668) & 0 \\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{Profile}} & 0 & 0 & 0 & 0 & 0 & 0 & 1867 (1089) \\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{Element Types Configuration}} & 0 & 11 (0) & 11 (0) & 0 & 0 & 0 & 237 (61) \\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{Palette Configuration}} & 0 & 50 (0)& 50 (0)& 0 & 50 (0) & 50 (0) & 1305 (323) \\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{CSS}} & 0 & 195 (0)& 195 (0)& 0 & 195 (0)& 195 (0)& 537 (0)\\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{Creation Command}} & \cellcolor{Gray} & \cellcolor{Gray} & \cellcolor{Gray} & 0 & 0 & 0 & \cellcolor{Gray}  \\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{Architecture Model}} & \cellcolor{Gray} & \cellcolor{Gray}& \cellcolor{Gray} & 0 & 0 & 0 & \cellcolor{Gray}  \\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{Types Configuration}} & 0 & 10 (0)& 10 (0)& \cellcolor{Gray} & \cellcolor{Gray}& \cellcolor{Gray} & 788 (327) \\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{Diagram Configuration}} & 0 & 0 & 0 & \cellcolor{Gray} & \cellcolor{Gray}& \cellcolor{Gray} & 58 (28) \\ \hline
		%\multicolumn{1}{|M{2cm}|}{\textbf{plugin.xml}} & 0 & & & 82 \\ \hline
		%\multicolumn{1}{|M{2cm}|}{\textbf{MANIFEST.MF}} & 0 & & & \\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{Total}}  & \textbf{436 (668)} &\textbf{266 (0)} & \textbf{702 (668)} & \textbf{436 (668)} & \textbf{245 (0)} & \textbf{681 (668)} & \textbf{4792 (1828)} \\ \hline
		\cline{1-8}
	\end{tabular}
	\caption{Lines of manually written code of each file for creating a Papyrus UML profile and editor for ArchiMate.}
	\label{tab:evaluation}
\end{table}
\end{landscape}

\subsubsection{Threats to Validity}
There were a few minor features of the original Archimate for Papyrus tool that our approach could not support. 
Most of them are related to custom menu entries and wizards. For those to be created developer needs to extend the ``plugin.xml'' file. 
In addition, the line decoration shapes of stereotypes that extend the aggregation base element (i.e., diamond) can only be applied dynamically by running Java code that will update the property each time the stereotype is applied. 
Our default and polishing transformations are not able to generate those features automatically; these should be implemented manually. 
For that reason, we \textit{excluded} these lines of code needed by Archimate for Papyrus to implement these features from the data provided in Table~\ref{tab:evaluation} for a fair comparison. 

\subsection{Completeness}
\label{sec:completenessEvaluation}
In addition to the generation of the Archimate profile/editors, we tested the Jorvik with nine more Ecore metamodels from different domains. 
The names of the metamodels (including Archimate) and their size (in terms of types) are given in Table~\ref{tab:metamodels}. 
Next to the size, in parenthesis, the number of types that should be transformed so they can be instantiated as nodes/edges is also provided.

\begin{table}
	\centering
	\setlength{\tabcolsep}{3.5pt} 
	\begin{tabular}{|c|M{3cm}|c|M{3cm}|}
		\cline{1-4}
		\textbf{Name}  & \textbf{\#Types (\#Nodes/\#Edges)} & \textbf{Name}  & \textbf{\#Types (\#Nodes/\#Edges)}\\ \hline
		\textbf{Professor} & 5 (4/5)  & \textbf{Ant Scripts} & 11 (6/4) \\ \hline
		\textbf{Zoo} & 8 (6/4) & \textbf{Cobol} & 13 (12/14) \\ \hline
		\textbf{Usecase} & 9 (4/4) & \textbf{Wordpress} & 20 (19/18)  \\ \hline
		\textbf{Conference} & 9 (7/6) & \textbf{BibTeX} & 21 (16/2) \\ \hline
		\textbf{Bugzilla} & 9 (7/6) & \textbf{Archimate} & 57 (44/11) \\ \hline
		\cline{1-4}
	\end{tabular}
	\label{tab:metamodels}
	\caption{The names and sizes of the ten metamodels against which the approach was evaluated to test completeness}
\end{table}

As illustrated in Table~\ref{tab:metamodels}, the metamodels varied in size, from small profiles (having 5 stereotypes) to large profiles (up to 57 
stereotypes). 
The approach was able to produce the profiles and the editors for \textit{all} the metamodels, demonstrating that it can be used to generate the 
desired artifacts for a wide spectrum of domains. 
The time needed for the generation varied from miliseconds up to a few seconds. 
In the future, we plan to assess further the scalability of our approach using larger metamodels.

\subsection{User Experiment}
We have argued that using Jorvik provides significant gains in productivity when building custom editors for Papyrus.
We design a user experiment to substantiate such claim, and ascertain how significant the productivity gain can be.
As discussed in Section~\ref{sec:implementation}, there are 7 major steps to be taken in order to create a UML profile as well as its supporting editor. 
In this experiment, we have two processes: the manual process and the automatic process.
For the manual process we design 7 (+1) tasks (each with its own deadline) for the participants to complete towards manually creating a working UML profile-specifc editor.
For the automatic process we design 1 task for the participants to complete to automatically generate a working UML profile-specific editor using Jorvik.
We ask two participants to take part in the experiment, an work on two metamodels we choose. 
We record the time taken for the participants to complete the experiment and we compare efficiency of the manual process with the automatic process.

\subsubsection{Experiment Set-Up}
For the purpose of this experiment, we have chosen a participant with relatively more experience in modelling, and a candidate with less experience in modelling. 
For the experiment, both participants have an Eclipse IDE installed on their computers, with Eclipse Epsilon 1.6 Interim version\footnote{\url{https://www.eclipse.org/epsilon/}} and Eclipse Papyrus 4.0.0\footnote{\url{https://www.eclipse.org/papyrus/download.html}} installed.
For the purpose of this experiment, we ask the participants to work on two profiles, the Website profile\footnote{\url{https://github.com/wrwei/Jorvik/tree/master/org.papyrus.website}} and the Fault Tree profile\footnote{\url{https://github.com/wrwei/Jorvik/tree/master/org.papyrus.faulttree}}.
We also provide the SVG shapes and icons for these two profiles for the participants to use.

\begin{table}[ht!]
	\centering
	\setlength{\tabcolsep}{3.5pt} 
	\begin{tabular}{|c|c|c|c|}
		Task & Total (m) & Default (m) & Essential (m) \\ 
		1. UML Profile & 60 & 40 & 20 \\
		2. Element Types Configuration Model & 60 & 40 & 20 \\
		3. Palette Configuration Model & 30 & 20 & 10 \\
		4. Cascading Style Sheet & 30 & 20 & 10 \\
		5. Creation Command & 30 & 20 & 10 \\
		6. Architecture Model & 40 & 30 & 10 \\
		7. Plug-in Configuration & 20 & 12 & 8 \\
		8. OCL Constraints & 60 & 40 & 20 \\
	\end{tabular}
	\caption{Tasks and times for the manual process.}
	\label{tab:manual}
\end{table}

Before the experiment is conducted, a pre-experiment questionnaire is handed to the participants, so that they can assess their expertise in UML, UML profiles and Papyrus.
The experiment begins with the manual process.
In this process, we devise 7(+1) steps for the participants to take.
For each step, there is a set deadline, the participants are asked to try to complete the step within the deadline.
In each step, the participants are asked to complete a minimal task first (e.g. for UML profile, create a \textit{Stereotype} for Node and a \textit{Stereotype} for Edge)\footnote{Detailed descriptions of the steps can be found at \url{https://github.com/wrwei/Jorvik/tree/master/User\%20Experiment}}, and to continue if there is still time left, or give us an estimate of how long it will take to finish the whole step if the deadline is missed.
At the beginning of each step, we provide a piece of \textit{default} knowledge, which covers ground knowledge for the step to be completed.
The participants are also free to search for any information over the Internet which may assist them in their tasks.
At a certain point for each step, we assess if the participants are able to complete the step within the time frame, and we provide a piece of \textit{essential} knowledge, which contains key information (that is not accessible from the Internet) for the participants to complete the step.
The participants start with the Website profile, and then the Fault Tree profile.

The overview of the tasks is provided in Table~\ref{tab:manual}, the detailed task descriptions are as follows:
\begin{enumerate}
	\item UML Profile - An image of a UML profile is provided to the participants, they are required to create the profile within 60 minutes.
	The \textit{Default} information is provided at the beginning. 
	40 minutes in the task, we assess the participants' status and provide the \textit{Essential} information.
	\item Element Types Configuration Model - The participants are asked to create an Element Types Configuration model for the editor within 60 minutes. 
	The \textit{Default} information is provided at the beginning. 
	40 minutes in the task, we assess the participants' status and provide the \textit{Essential} information.
	\item Palette Configuration Model - The participants are asked to create a Palette Configuration model for the editor within 30 minutes.
	The \textit{Default} information is provided at the beginning. 
	20 minutes in the task, we assess the participants' status and provide the \textit{Essential} information.
	\item Custom Style - The participants are asked to create a CSS file to customise the styles of the editor within 30 minutes.
	The \textit{Default} information is provided at the beginning. 
	20 minutes in the task, we assess the participants' status and provide the \textit{Essential} information.
	\item Creation Command - The participants are asked to create a Java class to initialise the Papyrus diagram within 30 minutes.
	The \textit{Default} information is provided at the beginning. 
	20 minutes in the task, we assess the participants' status and provide the \textit{Essential} information.
	\item Architecture Model - The participants are asked to create an Architecture model for the editor within 40 minutes.
	The \textit{Default} information is provided at the beginning. 
	30 minutes in the task, we assess the participants' status and provide the \textit{Essential} information.
	\item Plug-in Configuration - The participants are asked to configure their Plug-ins in order to make use of all the models/artefacts to form a working editor, within 20 minutes.
	The \textit{Default} information is provided at the beginning. 
	12 minutes in the task, we assess the participants' status and provide the \textit{Essential} information.
	\item OCL constraints (optional) - In this optional task, the participants are asked to create OCL constraints mentioned in Section~\ref{sec:constraints} for all connector \textit{Stereotype}s, within 60 minutes. 
	We do not expect this task to be taken by participants, as it typically required experienced OCL experts 2 weeks to complete the constraint templates described in Section~\ref{sec:constraints}.
	For the record, no participants agreed to take this optional task.
\end{enumerate}

For each step, when participants express that they have completed the step, we stop the timer and assess the solutions. 
If the solutions are not correct, we tell the participants that they need more work and resume the timer.
Since each step depends on the previous being completed, at the beginning of each step, the participants are given a partial solution that contains complete and correct assets for all the previous tasks.

After the participants complete the manual process, a post-experiment questionnaire is handed to the participants, in which they evaluate the difficulties of each task and if enough time is provided for each task.
The participants repeat the manual process for both profiles.

\begin{table}[ht!]
	\centering
	\setlength{\tabcolsep}{3.5pt} 
	\begin{tabular}{|c|c|c|c|}
		Task & Total (m) & Default (m) & Essential (m) \\ 
		1. Ecore Metamodel + Generation & 50 & 30 & 20 \\
	\end{tabular}
	\label{tab:automatic}
	\caption{Tasks and times for the automatic process.}
\end{table}


The experiment then proceeds to the automatic process (overview in Table~\ref{tab:automatic}), where they need to complete one task:
\begin{enumerate}
	\item Annotated Ecore Metamodel and Generation - The participants are provided with the same image of the profiles, they are asked to create an annotated Ecore metamodel for the profile, and generate the UML profile and the editor, within 50 minutes.
	The \textit{Default} information is provided at the beginning. 
	30 minutes in the task, we assess the participants' status and provide the \textit{Essential} information.
\end{enumerate}
We record the time taken for the participants to complete the manual process and the automatic process.

\input{resultsTable.tex}

\subsubsection{Results}
Table~\ref{tab:experiment} shows the times obtained from the user experiment.
For the experiment, participant \#1 is a female PhD student who has a high level of expertise in modelling, and has used Papyrus before.
Participant \#2 is a male PhD student who has an intermediate level of expertise in modelling, and has used Papyrus on a limited number of occasions.

Below is the summary for Participant \#1 for the manual process for the Website profile:
\begin{enumerate}
	\item She was able to finish the UML profile creation in 25 minutes without the essential information. 
	\item She finished the Element Types Configuration in 56 minutes with the help of the essential information. \textcircled{1} she claimed that she found a solution online.\footnote{Which is the forum thread where the authors obtained the correct way of creatin Element Types Configurations: \url{https://www.eclipse.org/forums/index.php/t/1096471/}}.
	\item She could not figure out how to complete the Palette Configuration model, we provided her with the essential information, which helped her finish the model in 26 minutes (for the minimal task). \textcircled{3}She claims that she would need 20 more minutes to finish the model.
	\item She finished a partial solution for the CSS in 15 minutes.
	\item She could not figure out how to create a creation command, therefore essential information is provided, and she finished the step in 25 minutes in total (\textcircled{5}She copied the solution).
	\item She could not figure out how to create an Architecture model, even with the essential information provided she still missed the deadline.
	\item She was not able to configure the editor Plug-in to successfully run the editor, even with the essential information. \textcircled{8}She claims that she would need 30+ minutes to finish the configuration.
\end{enumerate}
In total Participant \#1 spent 208 minutes 30 seconds on the manual process for the Website profile.

Below is the summary for Participant \#2 for the manual process for the Fault Tree Profile:

\begin{enumerate}
	\item She was able to finish the UML profile creation in 15 minutes without the essential information. 
	\item She finished the Element Types Configuration in 38 minutes without the help of the essential information.
	\item She finished the Palette configuration model in 25 minutes without the help of the essential information.
	\item She finished a complete solution for the CSS in 16 minutes.
	\item She finished the creation command java class in 16 minutes.
	\item She finished the architecture model in 25 minutes.
	\item She was able to configure the editor Plug-in to successfully run the editor in 10 minutes.
\end{enumerate}
In total Participant \#2 spent 140 minutes on the manual process for the Fault Tree profile.

Below is the summary for Participant \#2 for the manual process for the Website profile:
\begin{enumerate}
	\item He was able to finish the UML profile creation in 40 minutes without the essential information. 
	\item He could not finish the Element Types Configuration model, even with the help of the essential knowledge. 
	\item He could not figure out how to complete the Palette Configuration model, even with the essential knowledge. 
	\item He finished a partial solution for the CSS in 30 minutes.
	\item He could not figure out how to create a creation command, therefore essential information is provided, and he finished the step in 30 minutes in total.
	\item He could not figure out how to create an Architecture model, even with the essential information provided he still missed the deadline. \textcircled{6}He would need 60+ minutes to finish the model.
	\item He was able to configure the editor Plug-in to successfully run the editor in 19 minutes.
\end{enumerate}
In total Participant \#1 spent 249 minutes seconds on the manual process for the Website profile.

Below is the summary for Participant \#2 for the manual process for the Fault Tree Profile:

\begin{enumerate}
	\item He was able to finish the UML profile creation in 24 minutes without the essential information. 
	\item He finished the minimal task for the Element Types Configuration in 58 minutes with the help of the essential information. \textcircled{2}He would need 40+ minutes to complete the whole model.
	\item He finished the Palette configuration model in 22 minutes with the help of essential however the solution was not correct (\textcircled{4}).
	\item He finished a complete solution for the CSS in 19 minutes.
	\item He finished the creation command java class in 25 minutes.
	\item \textcircled{7}He finished the architecture model in 32 minutes with the help of the essential knowledge. However, the solution was incorrect.
	\item She was able to configure the editor Plug-in to successfully run the editor in 10 minutes.
\end{enumerate}
In total Participant \#2 spent 206 minutes on the manual process for the Fault Tree profile.


For the automatic process, participant \#1 was able to finish the Website Ecore metamodel in 32 minutes.
She was able to finish the Fault Tree Ecore metamodel in 15 minutes.
Participant \#2 was able to finish the Website Ecore metamodel in 37 minutes.
He was able to finish the Fault Tree Ecore metamodel in 38 minutes.

\subsubsection{Analysis}
Comparing the manual process with the automatic process, we can conclude that using Jorvik is able to increase the productivity by at least 10 times. 
We draw this conclusion based on the data presented in Table~\ref{tab:experiment} (especially when participants claim that they would need additional time to finish the complete solution for some steps), and also based on the fact that both participants chose not to complete the optional Step 8 (the OCL constraints), which may take significant time, even for experience OCL programmers.

We are also able to draw the conclusion that it is rather difficult to derive the models/artefacts needed for a working UML profile-specific editor. 
This is based on the experiment results that both participants got the majority of their models/artefacts wrong for the Website profile, which was the first profile + editor they worked on.
Although we provided the \textit{Essential} information, which is not publicly available on the Internet, the participants still could not get the models/artefacts right because of the inter-related nature of the models.
This is the direct evidence that creating a UML profile-specific editor in Papyrus is a labour-intensive and error-prone process.

When participants worked on the Fault Tree profile, they were able to refer to their solutions to the Website profile. 
Therefore we observe that the correctness of the models/artefacts for the Fault Tree profile improved significantly comparing to the Website profile. 
Although they may have adapted their Website soutions to their Fault Tree solution, the recorded time shows that Jorvik still dominates the manual process, especially taking the OCL constraints into consideration.

\subsubsection{Threats to Validity}
For the experiment we could not find experts that specialise in creating UML profiles and their supporting editors for Papyrus. 
This is typically due to the fact that this feature of Papyrus is not widely promoted and used.
However, we have manually created the Website profile and its editor and recorded the time it took us to finish the whole solution. 
We derive the deadlines for the steps in the manual process based on our time (we multiplied our time by a factor of 2). 
