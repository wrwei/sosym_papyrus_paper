\section{Evaluation}
\label{sec:evaluation}

In this section we evaluate Jorvik in three different ways. 
Firstly, we apply it to generate a Papyrus editor for the non-trivial Archimate UML profile~\cite{iacob2009archimate,haren2012archimate}. 
The Adocus Archimate for Papyrus\footnote{\url{https://github.com/Adocus/ArchiMate-for-Papyrus}} is an open-source tool that includes a profile for Archimate and the appropriate 
editors for Papyrus. 
This way, we can compare the proportion of the tool that Jorvik is able to generate automatically, check the number of polishing transformations that the user needs to write to complete the missing parts and finally, identify the aspects of the editor that our approach is not able to generate.
As a result we can to measure the \textit{efficiency} of Jorvik in generating profiles/editors against an existing relatively large profile/editor. 

Secondly, we assess the completeness of our approach by applying it on a number of other metamodels collected as part of the work presented in~\cite{williams2013metamodels}. 
This way, the approach is tested to check if it can successfully generate profiles and editors for a wide variety of scenarios.

Last, we conducted an experiment in which we asked software engineers to build Papyrus editors for a set of metamodels, both using Jorvik and creating all the required assets manually.

\subsection{The Archimate Profile}
\label{sec:efficiencyEvaluation}
The Archimate for Papyrus tool offers five kind of diagrams (i.e., Application, Business, Implementation and Migration, Motivation and Technology diagrams). 
Each of the diagrams uses different stereotypes from the Archimate profile. 

As shown in Figure~\ref{fig:approachOverview}, our approach starts by implementing the Ecore metamodel for the profile/editor we would like to generate. 
Thus, in this scenario we need to create the 5 Ecore metamodels and annotate those EClasses/EReferences that need to appear as nodes or edges on the diagrams. 
The profiles for each type of Archimate diagram and the editors can now be generated. 
At this point, five fully functional editors are generated that can be used to create each of the five types of diagrams that the Archimate for Papyrus tool also supports. 

Nevertheless, our generated editors do not offer some special features that the Archimate for Papyrus tool offers. 
For example, the latter offers a third drawer in the palette for some diagrams that is called ``Common'' and includes two tools (i.e., ``Grouping'' and ``Comment''). 
Another feature that is not supported by our default transformations is the fact that in Archimate for Papyrus, users are able to have the elements represented either by their shapes or by a coloured rectangle depending on the CSS class applied to them. 
In order to be able to implement such missing features, we need to write the extra polishing transformations. 
For brevity, we will not go into details on the content of the polishing transformations for this specific example.

Table~\ref{tab:evaluation}, summarises the lines of code we had to write manually to generate each file needed by Papyrus to create the 5 basic diagrams (column ``Jorvik'' / ``Handwritten'') and the number of lines of the polishing transformations that were needed to produce the enhanced editor (column ``Jorvik'' / ``Handwritten (Polishing)''). 
The totals are given in column ``Jorvik'' / ``Total''. 
For easier comparison, the total lines of code the authors of the Archimate for Papyrus had to write manually are provided in column ``Archimate for Papyrus'' / ``Total Handwritten''\footnote{The produced plugins generated with Jorvik for the Archimate profile can be downloaded from \url{https://github.com/wrwei/Jorvik}}.

\begin{table}[t]
	\caption{Lines of manually written code of each file for creating a Papyrus UML profile and editor for ArchiMate.}
	\centering
	\setlength{\tabcolsep}{3.5pt} 
	\begin{tabular}{M{2cm}|c|M{1.5cm}|c|M{1.9cm}|}
		\cline{2-5}
		& \multicolumn{3}{c}{\textbf{Jorvik}} & \textbf{Archimate for Papyrus}\\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{File}} & \textbf{Handwritten} & \textbf{Handwritten (Polishing)} & \textbf{Total} & \textbf{Total Handwritten}\\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{ECore}} & 436 & 0 & 436 & 0 \\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{Profile}} & 0 & 0 & 0 & 1867 \\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{Palette Configuration}} & 0 & 24 & 24 & 1305 \\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{Element Types Configuration}} & 0 & 11 & 11 & 237 \\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{Types Configuration}} & 0 & 10 & 10 & 788 \\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{Diagram Configuration}} & 0 & 0 & 0 & 58 \\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{CSS}} & 0 & 195 & 195 & 553 \\ \hline
		%\multicolumn{1}{|M{2cm}|}{\textbf{plugin.xml}} & 0 & & & 82 \\ \hline
		%\multicolumn{1}{|M{2cm}|}{\textbf{MANIFEST.MF}} & 0 & & & \\ \hline
		\multicolumn{1}{|M{2cm}|}{\textbf{Total}}  & \textbf{436} &\textbf{240} & \textbf{676} & \textbf{4608} \\ \hline
		\cline{1-5}
	\end{tabular}
	\label{tab:evaluation}
\end{table}

As one can see from the numbers, our approach requires about 90\% less 
handwritten code to produce the basic diagrams and about 85\% less code to 
produce the polished editor that matches the original Archimate for Papyrus 
editor. Our approach offers an editor that matches the original Archimate for 
Papyrus tool but also atop that the ETL transformation that allows the 
transformation of the created UML models back to EMF. The generation of OCL 
constraints is also an extra feature that our approach offers. In this 
scenario, however, the generation of constraints could not be assessed as the 
tool that we are comparing with (i.e., Archimate for Papyrus) allows any edge 
to connect any two types of nodes. We leave this evaluation as part of our 
future work.

\subsubsection{Threats to Validity}
There were a few minor features of the original Archimate for Papyrus tool
that our approach could not support. Most of them are related to custom menu
entries and wizards. For those to be created developer needs to extend the
``plugin.xml'' file. In addition, the line decoration shapes of stereotypes
that extend the aggregation base element (i.e., diamond) can only be applied
dynamically by running Java code that will update the property each time the
stereotype is applied. Our default and polishing transformations are not
able to generate those features automatically; these should be implemented
manually. For that reason, we \textit{excluded} these lines of code needed
by Archimate for Papyrus to implement these features from the data provided
in Table~\ref{tab:evaluation} to have a fair comparison. 

\subsection{Other Metamodels}
\label{sec:completenessEvaluation}
In addition to the generation of the Archimate profile/editors, we tested the 
proposed approach with nine more Ecore metamodels from different domains. The 
names of the metamodels (including Archimate) and their size (in terms of 
types) are given in Table~\ref{tab:metamodels}. Next to the size, in 
parenthesis, the number of types that should be transformed so they can be 
instantiated as nodes/edges is also provided.

\begin{table}[t]
	\caption{The names and sizes of the ten metamodels against which the approach was evaluated to test completeness}
	\centering
	\setlength{\tabcolsep}{3.5pt} 
	\begin{tabular}{|c|M{2cm}|c|M{2cm}|}
		\cline{1-4}
		\textbf{Name}  & \textbf{\#Types (\#Nodes/\#Edges)} & \textbf{Name}  & \textbf{\#Types (\#Nodes/\#Edges)}\\ \hline
		\textbf{Professor} & 5 (4/5)  & \textbf{Ant Scripts} & 11 (6/4) \\ \hline
		\textbf{Zoo} & 8 (6/4) & \textbf{Cobol} & 13 (12/14) \\ \hline
		\textbf{Usecase} & 9 (4/4) & \textbf{Wordpress} & 20 (19/18)  \\ \hline
		\textbf{Conference} & 9 (7/6) & \textbf{BibTeX} & 21 (16/2) \\ \hline
		\textbf{Bugzilla} & 9 (7/6) & \textbf{Archimate} & 57 (44/11) \\ \hline
		\cline{1-4}
	\end{tabular}
	\label{tab:metamodels}
	
	\vspace*{-3mm}
\end{table}

As illustrated in Table~\ref{tab:metamodels}, the metamodels varied in size, 
from small profiles (having 5 stereotypes) to large profiles (up to 57 
stereotypes). The approach was able to produce the profiles and the editors for 
\textit{all} the metamodels, demonstrating that it can be used to generate the 
desired artifacts for a wide spectrum of domains. The time needed for the 
generation varied from miliseconds up to a few seconds. In the future, we plan 
to assess further the scalability of our approach using larger metamodels.

\subsection{Experiment}
We have argued that using Jorvik provides significant gains in productivity when building custom editors for Papyrus.
The experiment was designed to ascertain how significant the gains can be. The time taken to build a custom editor was recorded for both the Jorvik and the non-automated approach by novice and intermediate UML and Profiles users. The results suggest that regardless of the user expertise, the gains in productivity can be as high as 10 fold.

\subsubsection{Method}
\todo{Are we using Sina as participant or not?}
Three participants completed all conditions of this study: two where novice and one intermediate users.
Participants are all computer science graduates with Masters Degree in CS too.
All participants were naive to the purpose of the experiment.

\subsection{Materials}
All participants used a computer with the Eclipse IDE available with the Papyrus and Jorvik plugins installed.
The computer has internet access.
Two questionnaires where used. One, before the experiment, so participants could self asses their expertise in UML, UML profiles and Papyrus.
The second one, after the experiment, to record how participants perceived the difficulty of completing each of the tasks.
The second questionnaire uses a 10-point Likert response scale to measure their confidence for completing each of the tasks.
Questionnairs are available in Appendix\,\ref{app:quest}

\subsection{Procedure}
Participants run the experiments individually.
We identified eight main tasks required to build a custom editor for a Papyrus profile in the non-automated approach.
For the Jorvik approach two main tasks are required.
Each task was given a total allotted time for completion. Further, this time was divided into two sections: basic and essential.
In the basic section participants are expected to complete the task only using their knowledge and any information available on-line or elsewhere.
In the essential section, essential information\footnote{The essential information is provided as a set of step-by-step instructions.} on how to complete the task is given to the participants.

Participants are asked to complete each of the tasks individually and the total time to complete the task is recorded.
When a participant expresses that he/she has completed the task the timer is paused and an assessment of their progress is made.
If the assets they have developed will not be sufficient to have a functional editor they are asked to continue working and the timer is resumed.
After the basic time is up, if the participant has not completed the task, the timer is paused and the essential information (in the form of instructions written in paper\todo{paper or digital?})
is provided.
The timer is resumed and participants are allowed to continue working.

Since each task depends on the previous being completed, at the beginning of each task, the participants are given a partial solution that contains complete and correct assets for all the previous tasks.
The experiment was carried out in a single day in two sessions.
Tasks 1-4 are scheduled in the morning and tasks 4-8 in the afternoon with a 1 hour break for lunch.

\begin{table}
    \caption{Tasks and times for the non-automated approach}
    \centering
    \setlength{\tabcolsep}{3.5pt} 
    \begin{tabular}{|c|c|c|c|}
        Task & Total Time (m) & Basic Time (m) & Essential Time (m) \\ 
        UML Profile & 60 & 40 & 20 \\
        Element Types Configuration model & 60 & 40 & 20 \\
        Palette Configuration model & 60 & 40 & 20 \\
        Cascading Style Sheet & 30 & 20 & 10 \\
    \end{tabular}
\end{table}

\begin{table}
    \caption{Tasks and times for the Jorvik approach}
    \centering
    \setlength{\tabcolsep}{3.5pt} 
    \begin{tabular}{|c|c|c|c|}
        Task & Total Time (m) & Basic Time (m) & Essential Time (m) \\ 
        Profile Metamodel & 60 & 40 & 20 \\
        Run Jorvik & 60 & 40 & 20 \\
    \end{tabular}
\end{table}

Total allotted time for completion is based on timing the tasks while done by an expert on Papyrus and creating custom editors for profiles.
The time given to the participants was double the time taken by the expert.
The reason for this choice was to allow non-experts enough time and also limit the total duration of the experiment to prevent participant exhaustion.
The basic/essential times ratio was picked to be 2:1 arbitrarily, but with the aim to give participants the opportunity to complete the task once the essential information was provided.
This is assuming the participants did some progress during the basic window and only needed the essential information to finalize key details.

\subsubsection{Results}



\subsubsection{Discussion}
Weaknesses/Threats!

%The implementation of our approach was driven initially by examining the Archimate for Papyrus tool. Although we believe that Archimate for Papyrus offers a complete UML profile solution, there might be other editors that offer other functionality which our approach cannot offer. As a result, the efficiency gain reported might not be that substantial when comparing with other editors. \dk{This can be a showstopper as we're evaluating against the main example we used to develop the tool. I don't think there's a reason to alarm the reviewers.}
